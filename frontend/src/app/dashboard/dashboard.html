<div class="mobile-app">
  <!-- Top Search Bar -->
  <div class="top-bar">
    <div class="search-container">
      <div class="search-input-wrapper">
        <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
        <input type="text" placeholder="Search..." class="search-input">
      </div>
    </div>
    <div class="top-actions">
      <button class="notification-btn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
          <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
        </svg>
        <span class="notification-dot"></span>
      </button>
      <div class="profile-avatar" (click)="logout()" [title]="'Logged in as: ' + (currentUser?.username || 'Unknown')">
        {{ currentUser?.name?.charAt(0) || 'U' }}
      </div>
    </div>
  </div>

  <!-- Main Content Area -->
  <div class="main-content">
    <!-- Map Container -->
    <div class="map-section">
      <div #mapContainer class="map"></div>
      
      <!-- Location Permission Overlay -->
      <div class="location-overlay" *ngIf="!locationPermissionGranted">
        <div class="location-prompt">
          <div class="location-icon">üìç</div>
          <h3>Enable Location</h3>
          <p>Allow location access to discover people nearby</p>
          <button class="enable-location-btn" (click)="requestLocationPermission()">
            Enable Location
          </button>
          <button class="mock-location-btn" (click)="useMockLocation()">
            Use Demo Location
          </button>
        </div>
      </div>

      <!-- Floating Action Button -->
      <button class="fab" (click)="refreshNearbyUsers()" *ngIf="locationPermissionGranted">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <polyline points="23 4 23 10 17 10"></polyline>
          <polyline points="1 20 1 14 7 14"></polyline>
          <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
        </svg>
      </button>

      <!-- Quick Action Button -->
      <button class="quick-action-btn" 
              (click)="detectNearbyUsers()" 
              *ngIf="locationPermissionGranted"
              [disabled]="isScanning">
        {{ isScanning ? '...' : 'üë•' }}
      </button>
    </div>

    <!-- AirDrop-style Nearby Users Panel -->
    <div class="nearby-panel">
      <div class="panel-header">
        <h3>Nearby People</h3>
        <span class="user-count">{{ nearbyUsers.length + bluetoothDevices.length }}</span>
      </div>

      <!-- GPS Users Section -->
      <div class="users-section" *ngIf="nearbyUsers.length > 0">
        <div class="section-title">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
            <circle cx="12" cy="10" r="3"></circle>
          </svg>
          GPS Users
        </div>
        <div class="airdrop-grid">
          <div class="airdrop-user" 
               *ngFor="let user of nearbyUsers" 
               (click)="selectUser(user)">
            <div class="airdrop-avatar">
              <div class="avatar-circle">{{ user.name.charAt(0).toUpperCase() }}</div>
            </div>
            <div class="airdrop-name">{{ user.name }}</div>
            <div class="airdrop-distance">{{ user.distance }}m</div>
          </div>
        </div>
      </div>

      <!-- Bluetooth Users Section -->
      <div class="users-section" *ngIf="bluetoothDevices.length > 0">
        <div class="section-title">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M6.5 6.5L17.5 17.5L12 23L6.5 17.5L17.5 6.5L12 1L6.5 6.5Z"></path>
            <path d="M12 1L17.5 6.5L12 12"></path>
            <path d="M12 12L6.5 17.5L12 23"></path>
          </svg>
          Bluetooth Devices
        </div>
        <div class="airdrop-grid">
          <div class="airdrop-user" 
               *ngFor="let device of bluetoothDevices">
            <div class="airdrop-avatar bluetooth">
              <div class="avatar-circle bluetooth">üì±</div>
            </div>
            <div class="airdrop-name">{{ device.name }}</div>
            <div class="airdrop-distance">Bluetooth</div>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="nearbyUsers.length === 0 && bluetoothDevices.length === 0">
        <div class="empty-icon">üë•</div>
        <h4>No one nearby</h4>
        <p>Enable location and tap "Find Users" to discover people around you</p>
        <button class="scan-btn" 
                (click)="detectNearbyUsers()" 
                [disabled]="isScanning || !locationPermissionGranted">
          {{ isScanning ? 'Scanning...' : 'Find Users' }}
        </button>
        <button class="bluetooth-btn" 
                (click)="scanBluetoothDevices()" 
                [disabled]="isScanning">
          {{ isScanning ? 'Scanning...' : 'Scan Bluetooth' }}
        </button>
        <button class="clear-btn" 
                (click)="clearNearbyUsers()">
          Clear Users
        </button>
      </div>
    </div>
  </div>

  <!-- User Profile Modal -->
  <div class="user-profile-modal" *ngIf="showUserProfile && selectedUser" (click)="closeUserProfile()">
    <div class="user-profile-content" (click)="$event.stopPropagation()">
      <button class="close-btn" (click)="closeUserProfile()">√ó</button>
      <div class="profile-header">
        <div class="profile-avatar-large">
          <div class="avatar-fallback-large">{{ selectedUser.name.charAt(0).toUpperCase() }}</div>
        </div>
        <h2>{{ selectedUser.name }}</h2>
        <p>@{{ selectedUser.username }}</p>
        <div class="profile-distance">{{ selectedUser.distance }}m away</div>
      </div>
      <div class="profile-actions">
        <button class="action-btn primary">Message</button>
        <button class="action-btn secondary">Follow</button>
      </div>
    </div>
  </div>

  <!-- Bottom Navigation -->
  <div class="bottom-nav">
    <button class="nav-item">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
        <polyline points="9,22 9,12 15,12 15,22"></polyline>
      </svg>
    </button>
    <button class="nav-item">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
        <line x1="16" y1="2" x2="16" y2="6"></line>
        <line x1="8" y1="2" x2="8" y2="6"></line>
        <line x1="3" y1="10" x2="21" y2="10"></line>
      </svg>
    </button>
    <button class="nav-item active">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
        <circle cx="12" cy="10" r="3"></circle>
      </svg>
    </button>
    <button class="nav-item">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
        <circle cx="9" cy="7" r="4"></circle>
        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
      </svg>
    </button>
    <button class="nav-item">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
      </svg>
    </button>
  </div>
</div>